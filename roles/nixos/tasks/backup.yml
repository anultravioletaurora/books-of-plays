- name: "Create backup directory"
  become: true
  ansible.builtin.file:
    path: "/etc/nixos_backups"
    state: directory 

- name: "Create archive of  '/etc/nixos' directory"
  become: true
  community.general.archive:
    path: "/etc/nixos"
    dest: "/etc/nixos_backups/{{ '%Y-%m-%d_%H-%M-%S' | strftime }}.tar.gz"